<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista Escolas</title>
    <link rel="stylesheet" href="/frontend/estilos/administrador/criar-escola.css">
    <link rel="stylesheet" href="/frontend/frameworks/bootstrap-4.5.3-dist/css/bootstrap.css">
    <script src="/frontend/frameworks/jquery/jquery-3.5.1.min.js"></script>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-sm bg-dark navbar-dark nav justify-content-end" id="navegacao">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Administrador</a>
                </li>
            </ul>
        </nav>
    </header>

    <main>
        <fieldset>
            <div id="registro-escola-diretor">
                <table id="escolas-diretores">
                    <thead>
                        <tr class="alternado" style="width:1600px">
                            <th>Nome Escolar</th>
                            <th>Nome dos Diretores</th>
                        </tr>
                    </thead>
                    <tbody id="tbLista">
                        
                    </tbody>
                </table>
            </div>
        </fieldset>
        <div id="idLoad" class="loader">
        </div>
    </main>

    <script>





        listaEscolas();
        console.log("carregando");
        async function listaEscolas(){
            var resposta = await usarApi("GET", "http://localhost:8080/api/escolas");
            console.log(resposta)
            var escolas = JSON.parse(resposta);

            setTimeout(async function() {
                for (let i = 0; i < escolas.length; i++) {
                    var linha = document.createElement("tr");
                    var coluna = document.createElement("td");
                    var coluna2 = document.createElement("td");
                    var input = escolas[i].nome;
                    
                    coluna.append(input);
                    linha.append(coluna);
                    
                    
                    var diretor = await usarApi("GET","http://localhost:8080/api/diretor/escola/"+escolas[i].idEscola);
                    diretor = JSON.parse(diretor);
                    coluna2.append(diretor.nome);
                    linha.append(coluna2);
                    document.getElementById('tbLista').append(linha)
                }
                document.getElementById("idLoad").style.display = "none";
            }, 3000)
        }

        function usarApi(method, url) {
            return new Promise(function (resolve, reject) {
                let xhr = new XMLHttpRequest();
                xhr.open(method, url);
                xhr.onload = function () {
                    if (this.status >= 200 && this.status < 300) {
                        resolve(xhr.response);
                    } else {
                        reject({
                            status: this.status,
                            statusText: xhr.statusText
                        });
                    }
                };
                xhr.onerror = function () {
                    reject({
                        status: this.status,
                        statusText: xhr.statusText
                    });
                };
                xhr.send();
            });
        }

    </script>
    
</body>
</html>