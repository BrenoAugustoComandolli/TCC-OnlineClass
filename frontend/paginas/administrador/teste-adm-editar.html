<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="divInputs">
        <form action="">
            <label for="idID">ID escola:</label><br>
            <input type="number" name="nmId" id="idID" disabled>
            <br><br>
            <label for="idNome">Nome:</label><br>
            <input type="text" id="idNome">
            <br><br>
            <label for="idDataInic">Data Inicio:</label><br>
            <input type="date" name="nmDataInic" id="idDataInic" >
            <br><br>
            <label for="idDataFim">Data Final:</label><br>
            <input type="date" name="nmDataFim" id="idDataFim">
            <br><br>
            <label for="idDiretor">Diretor: </label>
            <input type="text" id="idDiretor" disabled>
            <br><br>
            <button type="button" id="btnDiretor" hidden>Remover Diretor</button>
            <select name="nmDiretor" id="SelectDiretor" hidden>

            </select>
            <br><br><br>
            <button>Alterar</button>
        </form>
    </div>




    <script>
        var idEscola = sessionStorage.getItem('idEscolaSelecionada')
        carregarCampos(idEscola);
        carregarSelect();
        var btnDiretor = document.getElementById('btnDiretor');
        
        async function carregarCampos(idEscola) {
            var resposta = await usarApi("GET", "http://localhost:8080/api/escola/" + idEscola)
            var escola = JSON.parse(resposta)
            console.log(escola)

            document.getElementById('idID').value = escola.idEscola;
            document.getElementById('idNome').value = escola.nome;
           //document.getElementById('idDataInic').textContent = escola.dataInicioLetivo;

            resposta = await usarApi("GET", "http://localhost:8080/api/diretor/escola/" + idEscola)
            var diretor = JSON.parse(resposta);
            var btnDiretor = document.getElementById('btnDiretor');
            if (diretor.fk_escola == null) {
                document.getElementById('SelectDiretor').hidden = false;
            } else {
                btnDiretor.hidden = false;
                document.getElementById('idDiretor').value = diretor.nome;
            }

            
        }
        
        async function carregarSelect() {
            var resposta = await usarApi("GET", "http://localhost:8080/api/diretores/disponiveis");
            var diretores = JSON.parse(resposta);

            var selectDiretoresDisponiveis = document.getElementById("SelectDiretor");
            for (let index = 0; index < diretores.length; index++) {
                var option = document.createElement("option");;
                option.textContent = diretores[index].nome;
                //A opção selecionada retornará o ID do diretor
                option.value = diretores[index].idUsuario;
        
                selectDiretoresDisponiveis.appendChild(option);
                }
        }










            //Método para chamada da API - requisição de lista de escolas 
    function usarApi(method, url) {
        return new Promise(function (resolve, reject) {
            let xhr = new XMLHttpRequest();
            xhr.open(method, url);
            xhr.onload = function () {
                if (this.status >= 200 && this.status < 300) {
                    resolve(xhr.response);
                } else {
                    document.getElementById("idLoad").style.display = "none";
                    document.getElementById("idErro").textContent = "Sem Conexão com a Base de Dados - Erro (0001)";
                    document.getElementById("idErro").style.display = "block";
                    reject({
                        status: this.status,
                        statusText: xhr.statusText
                    });
                }
            };
            xhr.onerror = function () {
                document.getElementById("idLoad").style.display = "none";
                document.getElementById("idErro").textContent = "Sem Conexão com a Base de Dados - Erro (0001)";
                document.getElementById("idErro").style.display = "block";
                reject({
                    status: this.status,
                    statusText: xhr.statusText
                });
            };
            xhr.send();
        });
    }








    
/* Métodos para teste

alterarBotão();
carregarSelect();
function alterarBotão() {
    var btn = document.getElementById("btnConverter")
    if()
    btn.textContent="Remover Diretor"
}
var diretorDisp = document.getElementById("idDiretor")
async function carregarDiretor(idEscola) {
    var diretorTeste = await usarApi("GET","http://localhost:8080/api/diretor/escola/"+idEscola);
    var diretorTeste2 = JSON.parse(diretorTeste)
    diretorDisp.value = diretorTeste2.nome;
}
async function carregarSelect() {
    var resposta = await usarApi("GET", "http://localhost:8080/api/diretores");
    console.log(resposta);
     var diretores = JSON.parse(resposta);

     var selectDiretoresDisponiveis = document.getElementById("SelectDiretor");
     for (let index = 0; index < diretores.length; index++) {
         var option = document.createElement("option");;
         option.textContent = diretores[index].nome;
         //A opção selecionada retornará o ID do diretor
         option.value = diretores[index].idUsuario;
        
         selectDiretoresDisponiveis.appendChild(option);
     }
}
*/


//-----------Alterar------------

// //Método para edição da escola  
// async function editarEscola(idEscola) {
//     //var escolaEscolhida = document.getElementById("Subtituir pelo id da escola recebido ao selecionar qual escola será editada")
//     //var diretorAtual = document.getElementById("Subtituir pelo id do diretor recebido ao selecionar qual escola será editada")

//     //Edita a escola
//     var alterarEscola = {
//         //"idEscola": escolaEscolhida.idEscola,
//         //"nome": input nome,
//         //"dataInicioLetivo": input dataInicio,
//         //"dataFinalLetivo": input dataFinal
//     }
//     var escolaJson = JSON.stringify(alterarEscola);
//     console.log(escolaJson);
//     var updateEscola = await usarApi("PUT", "http://localhost:8080/api/escola/alterar/"+escolaEscolhida.idEscola+"/"+escolaJson)

//     //Traz todos os diretores que podem ser adicionados à escola e popula eles em uma Drop Down list(Select)
//     //Atualizar os id's conforme necessitado pela página
//     var resposta = await usarApi("GET", "http://localhost:8080/api/diretores");
//     console.log(resposta);
//     var diretores = JSON.parse(resposta);

//     var selectDiretoresDisponiveis = document.getElementById("idSelectDiretores");
//     for (let index = 0; index < diretores.length; index++) {
//         var option = document.createElement("option");;
//         option.textContent = diretores[index].nome;
//         //A opção selecionada retornará o ID do diretor
//         option.value = diretores[index].idUsuario;
        
//         selectDiretoresDisponiveis.appendChild(option);
//     }

    
//     //Remove o atual diretor deletando-o do banco de dados e atualiza o novo diretor da escola
//     var idDiretorNovo = selectDiretoresDisponiveis.value;
//     if (diretorAtual.idUsuario != idDiretorNovo) {
//         updateDiretor(idEscola, diretorAtual.idUsuario, idDiretorNovo);
//     }
    
// }

//---------Alterar----------
// /*
// Método para remover o atual diretor de uma escola, deletando-o da tabela usuario no banco de dados e atribuindo um novo diretor à escola em seguida
// */
// function updateDiretor(idEscola, idDiretorAtual, idDiretorNovo) {
//     //Deleta o atual diretor no banco de dados
//     var deletarUsuario = await usarApi("DELETE", "http://localhost:8080/api/usuario/deletar/"+idDiretorAtual);

//     //Atualiza para o novo diretor da escola
//     var updateDiretor = await usarApi("PUT", "http://localhost:8080/api/diretor/escola/alterar/"+idEscola+"/"+idDiretorNovo)
// }
    </script>
</body>
</html>